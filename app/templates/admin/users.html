{% extends "admin/base.html" %}

{% block content %}
<div class="mb-8 flex justify-between items-center">
    <h1 class="text-3xl font-bold bg-gradient-to-r from-red-500 to-red-700 bg-clip-text text-transparent">
        User Management
    </h1>
    <div class="flex space-x-4">
        <div class="relative">
            <input type="text" placeholder="Search users..." 
                   class="pl-10 pr-4 py-2 rounded-lg border border-gray-800 bg-black text-white focus:border-red-500 focus:ring-2 focus:ring-red-900 transition-all placeholder-gray-500">
            <i class="fas fa-search absolute left-3 top-3 text-gray-500"></i>
        </div>
    </div>
</div>

<div class="relative group overflow-hidden">
    <!-- Background glow effect -->
    <div class="absolute -inset-0.5 bg-gradient-to-r from-red-500 to-red-700 rounded-xl blur-sm opacity-25 group-hover:opacity-40 transition duration-300"></div>
    
    <!-- Content -->
    <div class="relative bg-black rounded-xl border border-gray-800 p-6">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="text-left border-b border-gray-800">
                        <th class="px-6 py-4 text-gray-400 font-semibold">ID</th>
                        <th class="px-6 py-4 text-gray-400 font-semibold">Username</th>
                        <th class="px-6 py-4 text-gray-400 font-semibold">Email</th>
                        <th class="px-6 py-4 text-gray-400 font-semibold">Registration Date</th>
                        <th class="px-6 py-4 text-gray-400 font-semibold">Vehicles</th>
                        <th class="px-6 py-4 text-gray-400 font-semibold">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users.items %}
                    <tr class="hover:bg-gray-900 border-b border-gray-800 transition-colors">
                        <td class="px-6 py-4 text-white">{{ user.id }}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-red-900 bg-opacity-30 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-user text-red-500"></i>
                                </div>
                                <span class="text-white">{{ user.username }}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-gray-400">{{ user.email }}</td>
                        <td class="px-6 py-4 text-gray-400">{{ user.created_at.strftime('%Y-%m-%d') }}</td>
                        <td class="px-6 py-4">
                            <span class="bg-red-900 bg-opacity-30 text-red-500 px-3 py-1 rounded-lg text-sm">
                                {{ user.vehicles|length }} vehicles
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <form method="POST" action="{{ url_for('admin.delete_user', user_id=user.id) }}" class="inline">
                                <button type="submit" onclick="return confirm('Are you sure you want to delete this user? This action cannot be undone.')"
                                        class="bg-black hover:bg-red-900 p-2 rounded-lg text-red-500 hover:text-white transition-all duration-200">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if users.pages > 1 %}
        <div class="flex justify-center mt-6 space-x-2">
            {% for page in range(1, users.pages + 1) %}
            <a href="{{ url_for('admin.manage_users', page=page) }}" 
               class="px-4 py-2 rounded-lg {% if page == users.page %}bg-gradient-to-r from-red-600 to-red-800 text-white{% else %}bg-black border border-gray-800 text-gray-400 hover:bg-gray-900 hover:text-white{% endif %} transition-all duration-200">
                {{ page }}
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<!-- Toast notification for actions -->
<div id="toast-container" class="fixed bottom-4 right-4 z-50"></div>

<!-- Toast notification styling -->
<style>
.toast {
    padding: 12px 20px;
    border-radius: 8px;
    margin-bottom: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
    transform: translateY(100%);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    display: flex;
    align-items: center;
    border-left: 4px solid transparent;
}

.toast.success {
    background-color: rgba(0, 0, 0, 0.9);
    color: white;
    border-left-color: #10B981;
}

.toast.error {
    background-color: rgba(0, 0, 0, 0.9);
    color: white;
    border-left-color: #EF4444;
}

.toast.show {
    transform: translateY(0);
    opacity: 1;
}
</style>

<script>
// Function to show toast notifications
function showToast(message, type = 'success') {
    const toastContainer = document.getElementById('toast-container');
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    // Create icon based on type
    const icon = document.createElement('div');
    icon.className = 'mr-3 flex-shrink-0';
    if (type === 'success') {
        icon.innerHTML = '<svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
    } else {
        icon.innerHTML = '<svg class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
    }
    
    // Create message
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    
    // Assemble toast
    toast.appendChild(icon);
    toast.appendChild(messageDiv);
    toastContainer.appendChild(toast);
    
    // Trigger animation
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Auto remove after delay
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            if (toast.parentNode) {
                toastContainer.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

// Check for URL parameters to show toast messages
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('deleted')) {
        showToast('User deleted successfully', 'success');
    }
    if (urlParams.has('error')) {
        showToast(urlParams.get('error'), 'error');
    }
});
</script>
{% endblock %}